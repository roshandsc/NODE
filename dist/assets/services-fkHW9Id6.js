import{t as n}from"./main-BiPNyrep.js";const y=document.getElementById("premiumBookNowPopup"),i=document.getElementById("premiumPopupContainer"),D=document.getElementById("closePopupBtn"),H=document.querySelectorAll(".book-now-trigger"),q=document.getElementById("premiumRequestForm"),f=document.getElementById("reqService"),c=document.getElementById("submitRequestBtn"),E=document.getElementById("locPromptBar"),M=document.getElementById("btnPromptAllow"),d=document.getElementById("reqLocation"),h=document.getElementById("btnDetectLoc"),g=document.getElementById("reqIssueTrigger"),v=document.getElementById("reqIssueList"),T=document.getElementById("issueChipsContainer"),_=document.getElementById("customIssueWrapper"),m=document.getElementById("reqCustomIssue");let u=1;const C=4,Y=document.getElementById("stepperProgress"),R=document.querySelectorAll(".step-dot"),O=document.querySelectorAll(".form-step"),x=document.getElementById("btnStepNext"),b=document.getElementById("btnStepBack"),P=document.getElementById("reqTime"),A=document.getElementById("reqDate");let l=[];const V={plumbing:["issue_plumb_pipe","issue_plumb_tap","issue_plumb_drain","issue_plumb_pressure","issue_plumb_fittings"],electrical:["issue_elec_power","issue_elec_switch","issue_elec_wiring","issue_elec_fan"],repairs:["issue_rep_maint","issue_rep_install","issue_rep_inspect","issue_rep_furn"],construction:["issue_const_renov","issue_const_tile","issue_const_struct","issue_const_ceil"],domestic_help:["issue_dom_maid","issue_dom_cook","issue_dom_clean","issue_dom_month"],painter:["issue_paint_int","issue_paint_ext","issue_paint_touch","issue_paint_water"],mechanics:["issue_mech_car","issue_mech_bike","issue_mech_oil","issue_mech_batt"]};function S(t){v.innerHTML="";const e=localStorage.getItem("node-lang")||"en";(V[t]||[]).forEach(r=>{const p=document.createElement("div");p.className="smart-option",p.setAttribute("data-key",r),l.includes(r)&&p.classList.add("selected");const I=n[r]?n[r][e]:r;p.innerHTML=`
                        <span class="opt-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        </span>
                        ${I}
                        <span class="smart-option-tick">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        </span>
                    `,p.addEventListener("click",N=>{N.stopPropagation(),X(r,p)}),v.appendChild(p)});const o=document.createElement("div");o.className="smart-option",o.setAttribute("data-key","issue_other"),l.includes("issue_other")&&o.classList.add("selected");const a=n.issue_other?n.issue_other[e]:"Other (describe below)";o.innerHTML=`
                    <span class="opt-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                    </span>
                    ${a}
                    <span class="smart-option-tick">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </span>
                `,o.addEventListener("click",r=>{r.stopPropagation(),X("issue_other",o)}),v.appendChild(o)}function X(t,e){const s=l.indexOf(t);s>-1?(l.splice(s,1),e&&e.classList.remove("selected")):(l.push(t),e&&e.classList.add("selected")),L();const o=g.closest(".premium-form-group");o&&o.classList.remove("has-error"),l.includes("issue_other")?(_.classList.add("visible"),m.setAttribute("required","true"),setTimeout(()=>{document.activeElement!==m&&m.focus()},100)):(_.classList.remove("visible"),m.removeAttribute("required"),setTimeout(()=>m.value="",400))}function W(t,e){e&&e.stopPropagation();const s=l.indexOf(t);s>-1&&(l.splice(s,1),L(),Array.from(v.children).forEach(o=>{o.getAttribute("data-key")===t&&o.classList.remove("selected")}),l.includes("issue_other")||(_.classList.remove("visible"),m.removeAttribute("required"),m.value=""))}function L(){T.innerHTML="";const t=localStorage.getItem("node-lang")||"en";l.length>0?g.classList.add("has-value"):g.classList.remove("has-value"),l.forEach(e=>{const s=document.createElement("div");s.className="issue-chip";let o=e;e==="issue_other"?o=n.issue_other_short?n.issue_other_short[t]:"Other":n[e]&&(o=n[e][t]),s.innerHTML=`
                        <span>${o}</span>
                        <span class="chip-remove" aria-label="Remove">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </span>
                    `,s.querySelector(".chip-remove").addEventListener("click",a=>W(e,a)),T.appendChild(s)})}async function F(){if(h.classList.add("loading"),h.querySelector(".spinner").style.display="inline-block",!navigator.geolocation){B("Geolocation not supported");return}navigator.geolocation.getCurrentPosition(async t=>{const e=t.coords.latitude,s=t.coords.longitude;try{const a=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}&zoom=18&addressdetails=1`)).json();if(a&&a.display_name){const r=a.address,p=[r.road||r.neighbourhood||r.suburb,r.city||r.town||r.county].filter(Boolean).join(", ");d.value=p||a.display_name,$()}else B("Could not resolve address")}catch{d.value=`${e.toFixed(4)}, ${s.toFixed(4)}`,$()}},t=>{console.error(t),B("Permission denied or timeout")},{enableHighAccuracy:!1,timeout:8e3,maximumAge:0})}function $(){h.classList.remove("loading"),h.querySelector(".spinner").style.display="none",E.style.display="none",d.focus(),d.blur(),d.closest(".premium-form-group").classList.remove("has-error")}function B(t){h.classList.remove("loading"),h.querySelector(".spinner").style.display="none",E.style.display="none",d.placeholder="Enter your location manually",d.focus(),console.log("Location detect fail: "+t)}M.addEventListener("click",F);h.addEventListener("click",F);H.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),l=[],L(),_.classList.remove("visible"),m.value="",d.value?E.style.display="none":E.style.display="flex";const s=t.getAttribute("data-type");s?(f.value=s,S(s)):(f.value="",v.innerHTML=""),u=1,k(),y.classList.remove("closing"),y.classList.add("active"),document.querySelectorAll(".premium-form-group.has-error").forEach(o=>o.classList.remove("has-error")),i.style.transform="translateY(0) scale(1) perspective(1000px) rotateX(0deg) rotateY(0deg)"})});f.addEventListener("change",t=>{l=[],L(),S(t.target.value),_.classList.remove("visible"),m.value="",t.target.closest(".premium-form-group").classList.remove("has-error")});g.addEventListener("click",t=>{if(!t.target.closest(".chip-remove"))if(f.value)v.classList.toggle("open"),v.classList.contains("open")?g.classList.add("active-trigger"):g.classList.remove("active-trigger");else{const e=f.closest(".premium-form-group");e.classList.add("has-error");const s=localStorage.getItem("node-lang")||"en";e.querySelector(".inline-error").textContent=n.popup_err_service?n.popup_err_service[s]:"Please select a service type first",e.style.transform="translateX(-5px)",setTimeout(()=>e.style.transform="translateX(5px)",50),setTimeout(()=>e.style.transform="translateX(0)",100)}});document.addEventListener("click",t=>{!g.contains(t.target)&&!v.contains(t.target)&&(v.classList.remove("open"),g.classList.remove("active-trigger"))});q.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("input",()=>{const e=t.closest(".premium-form-group");e&&e.classList.remove("has-error")})});function j(t){let e=!0;if(t===1){const s=f.closest(".premium-form-group");if(!f.value){s.classList.add("has-error");const o=localStorage.getItem("node-lang")||"en";s.querySelector(".inline-error").textContent=n.popup_err_service?n.popup_err_service[o]:"Please select a service type",e=!1}}if(t===2){const s=d.closest(".premium-form-group");d.value.trim()||(s.classList.add("has-error"),e=!1)}if(t===3){const s=g.closest(".premium-form-group");if(l.length===0)s.classList.add("has-error"),e=!1;else if(l.includes("issue_other")&&!m.value.trim()){s.classList.add("has-error");const o=localStorage.getItem("node-lang")||"en";document.getElementById("issueError").textContent=n.popup_err_issues?n.popup_err_issues[o]:"Please describe your custom issue",e=!1}}if(t===4){const s=A.closest(".premium-form-group");A.value||(s.classList.add("has-error"),e=!1);const o=P.closest(".premium-form-group");P.value||(o.classList.add("has-error"),e=!1);const a=document.getElementById("reqName").closest(".premium-form-group");document.getElementById("reqName").value.trim()||(a.classList.add("has-error"),e=!1);const r=document.getElementById("reqPhone").closest(".premium-form-group");(!document.getElementById("reqPhone").value.trim()||document.getElementById("reqPhone").value.length<8)&&(r.classList.add("has-error"),e=!1)}return e}function k(){const t=(u-1)/(C-1)*100;Y.style.width=`${t}%`,R.forEach(e=>{const s=parseInt(e.getAttribute("data-step"));e.classList.remove("active","completed"),s===u?e.classList.add("active"):s<u&&e.classList.add("completed")}),O.forEach(e=>{e.classList.remove("active")}),document.getElementById(`step${u}`).classList.add("active"),u===1?(b.style.display="none",x.style.display="flex",c.style.display="none"):u===C?(b.style.display="flex",x.style.display="none",c.style.display="flex"):(b.style.display="flex",x.style.display="flex",c.style.display="none")}x.addEventListener("click",()=>{j(u)?(u++,k()):(i.style.transform="translateX(-10px)",setTimeout(()=>i.style.transform="translateX(10px)",50),setTimeout(()=>i.style.transform="translateX(-5px)",100),setTimeout(()=>i.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg)",150))});b.addEventListener("click",()=>{u>1&&(u--,k())});function w(){y.classList.add("closing"),setTimeout(()=>{y.classList.remove("active"),y.classList.remove("closing"),q.reset(),v.classList.remove("open"),g.classList.remove("active-trigger"),l=[],L(),_.classList.remove("visible"),document.querySelectorAll(".premium-form-group.has-error").forEach(s=>s.classList.remove("has-error")),u=1,k(),c.classList.remove("success");const t=localStorage.getItem("node-lang")||"en",e=n.popup_btn_send?n.popup_btn_send[t]:"Send Request";c.innerHTML=`
                        <span class="btn-text-content">
                            <span>${e}</span>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </span>
                    `},500)}D.addEventListener("click",w);y.addEventListener("click",t=>{t.target===y&&w()});i.addEventListener("mousemove",t=>{const e=i.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top,a=e.width/2,r=e.height/2,p=(o-r)/r*-4,I=(s-a)/a*4;i.style.transform=`perspective(1000px) rotateX(${p}deg) rotateY(${I}deg)`});i.addEventListener("mouseleave",()=>{i.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg)",i.style.transition="transform 0.5s ease"});i.addEventListener("mouseenter",()=>{i.style.transition="none"});q.addEventListener("submit",t=>{if(t.preventDefault(),!j(u)){i.style.transform="translateX(-10px)",setTimeout(()=>i.style.transform="translateX(10px)",50),setTimeout(()=>i.style.transform="translateX(-5px)",100),setTimeout(()=>i.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg)",150);return}const e=document.createElement("span");e.classList.add("ripple-effect"),e.style.left="50%",e.style.top="50%",e.style.width="200px",e.style.height="200px",e.style.marginLeft="-100px",e.style.marginTop="-100px",c.appendChild(e),c.style.pointerEvents="none";const s=c.querySelector(".btn-text-content span"),o=localStorage.getItem("node-lang")||"en";s&&(s.textContent=n.popup_btn_sending?n.popup_btn_sending[o]:"Sending..."),setTimeout(()=>{c.classList.add("success");const a=n.popup_btn_sent?n.popup_btn_sent[o]:"Request Sent!";c.innerHTML=`
                        <span class="btn-text-content">
                            <span>${a}</span>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </span>
                    `,setTimeout(()=>{w(),setTimeout(()=>{c.style.pointerEvents="all"},500)},1500)},1e3),setTimeout(()=>{e.parentNode&&e.remove()},600)});window.addEventListener("languageChanged",t=>{const e=t.detail.lang||"en";if(L(),f.value&&S(f.value),d.placeholder!==" "&&(d.placeholder=n.popup_loc_manual?n.popup_loc_manual[e]:"Enter your location manually"),!c.classList.contains("success")&&c.style.pointerEvents!=="none"){const s=c.querySelector(".btn-text-content span");s&&(s.textContent=n.popup_btn_send?n.popup_btn_send[e]:"Send Request")}});
